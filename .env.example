# Server Configuration
PORT=3001
TRUST_PROXY_LIST=loopback,uniquelocal
NODE_ENV=development

# CORS Configuration
# Comma-separated origins, example:
# CORS_ORIGINS=https://inaturaquizz.com,https://www.inaturaquizz.com
CORS_ORIGINS=http://localhost:5173

# AI provider
AI_API_KEY=replace_with_a_valid_key
AI_ENABLED=true
EXPLAIN_RATE_LIMIT_PER_MINUTE=8
EXPLAIN_DAILY_QUOTA_PER_IP=60

# Quiz round validation (server-authoritative answer checks)
ROUND_HMAC_SECRET=replace_with_random_32_chars_min
ROUND_STATE_TTL_MS=900000

# iNaturalist fetch protection
INAT_REQUEST_TIMEOUT_MS=8000
INAT_MAX_RETRIES=2
INAT_MAX_CONCURRENT_REQUESTS=14
INAT_BACKOFF_BASE_MS=350
INAT_BACKOFF_MAX_MS=6000

# Observation pool/cache tuning (few thousands active users)
QUESTION_CACHE_TTL_MS=600000
QUESTION_CACHE_STALE_TTL_MS=1800000
AUTOCOMPLETE_CACHE_TTL_MS=900000
AUTOCOMPLETE_CACHE_STALE_TTL_MS=3600000
TAXON_DETAILS_CACHE_TTL_MS=86400000
TAXON_DETAILS_CACHE_STALE_TTL_MS=604800000
SIMILAR_SPECIES_CACHE_TTL_MS=604800000
SIMILAR_SPECIES_CACHE_STALE_TTL_MS=2592000000
SELECTION_STATE_TTL_MS=1200000
MAX_QUESTION_CACHE_ENTRIES=500
MAX_TAXON_DETAILS_CACHE_ENTRIES=12000
MAX_SELECTION_STATES=1200
MAX_SIMILAR_SPECIES_CACHE_ENTRIES=5000
OBS_POOL_MAX_PAGES=3
OBS_POOL_DISTINCT_TAXA_TARGET=30
DEGRADE_POOL_MAX_TAXA=24
DEGRADE_POOL_MAX_OBS_PER_TAXON=2

# Reports
# Public write endpoint is enabled by default and protected by rate-limiting.
# Set REPORTS_REQUIRE_WRITE_TOKEN=true if you want to force bearer auth on POST /api/reports.
REPORTS_WRITE_TOKEN=replace_with_strong_token
REPORTS_READ_TOKEN=replace_with_strong_token
REPORTS_REQUIRE_WRITE_TOKEN=false
REPORTS_RATE_LIMIT_PER_WINDOW=8
REPORTS_RATE_LIMIT_WINDOW_MS=600000
REPORTS_STORE_FILE=server/data/reports-store.json
REPORTS_MAX_ENTRIES=3000
REPORTS_RETENTION_DAYS=45
REPORTS_IP_HASH_SALT=replace_with_random_32_chars_min

# First-party metrics dashboard
METRICS_STORE_FILE=server/data/metrics-store.json
METRICS_RETENTION_HOURS=336
METRICS_MAX_API_EVENTS=200000
METRICS_MAX_CLIENT_EVENTS=100000
METRICS_DASHBOARD_TOKEN=replace_with_strong_token
METRICS_DASHBOARD_REQUIRE_TOKEN=true

# Basic balancing dashboard
BALANCE_DASHBOARD_TOKEN=replace_with_strong_token
BALANCE_DASHBOARD_REQUIRE_TOKEN=true
BALANCE_DASHBOARD_EVENT_LIMIT=2000

# Beta KPI gate script (72h verification)
METRICS_BASE_URL=http://localhost:3001
BETA_REQUIRE_72H=true
BETA_API_ERROR_RATE_MAX=1.5
BETA_CRASH_FREE_MIN=99
BETA_REPORT_SUCCESS_MIN=95
BETA_ACTIVATION_MIN=70
BETA_COMPLETION_MIN=65
BETA_QUIZ_QUESTION_P95_MAX_MS=900
BETA_QUIZ_SUBMIT_P95_MAX_MS=700
# Minimum samples required to evaluate a KPI (avoid false green on tiny traffic)
BETA_MIN_API_REQUESTS_72H=120
BETA_MIN_API_REQUESTS_1H=1
BETA_MIN_APP_OPEN_72H=50
BETA_MIN_APP_OPEN_1H=1
BETA_MIN_ROUND_START_72H=50
BETA_MIN_ROUND_START_1H=1
BETA_MIN_REPORT_SUBMIT_72H=5
BETA_MIN_REPORT_SUBMIT_1H=1
BETA_MIN_QUIZ_QUESTION_72H=50
BETA_MIN_QUIZ_QUESTION_1H=1
BETA_MIN_QUIZ_SUBMIT_72H=50
BETA_MIN_QUIZ_SUBMIT_1H=1
BETA_THRESHOLDS_HISTORY_FILE=server/data/beta-thresholds-history.json

# Optional synthetic smoke input for KPI bootstrapping
BETA_SMOKE_PACK_ID=world_mammals
BETA_SMOKE_LOCALE=fr

# Lure system
GLOBAL_DIFFICULTY_BOOST=0.2
COOLDOWN_LURE_N=6
